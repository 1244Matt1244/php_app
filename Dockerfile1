# Koristimo službeni PHP-FPM image s Debianom (zadržavamo bazni image)
FROM php:8.3-fpm

# Instaliramo ovisnosti i čistimo u istom RUN sloju za optimizaciju
RUN apt-get update && apt-get install -y \
    libpq-dev \
    && docker-php-ext-install pdo_pgsql pgsql \
    && apt-get clean -y \
    && rm -rf /var/lib/apt/lists/*

# Postavljamo defaultne env varijable (koristiti ćemo docker-compose za override)
ENV DB_HOST=db
ENV DB_USER=default_user
ENV DB_PASSWORD=default_pass
ENV DB_NAME=default_db

# Kopiramo aplikaciju (sa .dockerignore za nepotrebne datoteke)
COPY ./html /usr/share/nginx/html

# Kopiramo php.ini samo ako postoji (wildcard za izbjegavanje grešaka)
COPY ./php.ini* /usr/local/etc/php/conf.d/

# Postavljamo radni direktorij i vlasnika
WORKDIR /usr/share/nginx/html
RUN chown -R www-data:www-data /usr/share/nginx/html

# Eksplicitno eksponiramo PHP-FPM port
EXPOSE 9000

# Pokrećemo PHP-FPM u foreground modu
CMD ["php-fpm", "-F"]
